# 마커 표시 문제 해결 가이드

지도는 표시되지만 사업 마커가 나타나지 않는 경우 확인사항입니다.

## 확인 사항

### 1. 데이터베이스에 좌표 정보가 있는지 확인

프로젝트 데이터에 `latitude`와 `longitude` 값이 있어야 합니다.

**확인 방법:**
```sql
-- SQLite에서 확인
SELECT id, title, country, latitude, longitude 
FROM projects 
WHERE latitude IS NOT NULL 
  AND longitude IS NOT NULL 
  AND latitude != 0 
  AND longitude != 0;
```

### 2. 브라우저 콘솔 확인

F12를 눌러 개발자 도구를 열고 Console 탭에서 다음 메시지를 확인:

**정상적인 경우:**
```
프로젝트 데이터 로드 시작...
API 응답: {success: true, data: [...], count: 5}
받은 프로젝트 수: 5
변환된 프로젝트 수: 5
좌표가 있는 프로젝트 수: 5
마커 업데이트 시작...
필터링된 프로젝트 수: 5
생성된 마커 수: 5
```

**문제가 있는 경우:**
- "받은 프로젝트 수: 0" → 데이터베이스에 좌표가 있는 프로젝트가 없음
- "좌표가 있는 프로젝트 수: 0" → 좌표 값이 유효하지 않음
- "생성된 마커 수: 0" → 마커 생성 실패

### 3. Network 탭 확인

개발자 도구의 Network 탭에서:
- `/api/gis/projects` 요청 확인
- 응답 상태: 200 OK
- 응답 데이터에 `data` 배열이 있고 프로젝트가 포함되어 있는지 확인

## 해결 방법

### 방법 1: 프로젝트에 좌표 추가

KRC 레포지토리의 JSON 파일에서 좌표 정보를 참고하여 프로젝트 데이터를 업데이트:

```python
# Python 스크립트 예시
from app import app, db
from models import Project
import json

with app.app_context():
    # KRC JSON 파일에서 좌표 읽기
    with open('KRC/data/global_oda.json', 'r', encoding='utf-8') as f:
        oda_data = json.load(f)
    
    # 프로젝트 업데이트
    for item in oda_data:
        project = Project.query.filter_by(country=item['name']).first()
        if project:
            project.latitude = item['lat']
            project.longitude = item['lng']
            db.session.commit()
```

### 방법 2: 수동으로 좌표 입력

관리자 페이지나 데이터베이스에서 직접 좌표를 입력:

```sql
-- 예시: 베트남 프로젝트에 좌표 추가
UPDATE projects 
SET latitude = 14.0583, longitude = 108.2772 
WHERE country = '베트남' AND latitude IS NULL;
```

### 방법 3: 테스트 데이터 추가

테스트용 프로젝트를 추가하여 마커가 표시되는지 확인:

```python
from app import app, db
from models import Project
from datetime import date

with app.app_context():
    test_project = Project(
        code='TEST-001',
        title='테스트 프로젝트',
        project_type='consulting',
        country='베트남',
        latitude=14.0583,
        longitude=108.2772,
        department='gad',
        status='in_progress',
        budget_total=1000000000
    )
    db.session.add(test_project)
    db.session.commit()
```

## 일반적인 문제

### 문제 1: "받은 프로젝트 수: 0"
**원인**: 데이터베이스에 좌표가 있는 프로젝트가 없음
**해결**: 프로젝트에 `latitude`와 `longitude` 값을 추가

### 문제 2: "좌표가 있는 프로젝트 수: 0"
**원인**: 좌표 값이 0이거나 유효하지 않음
**해결**: 좌표 값이 올바른지 확인 (위도: -90~90, 경도: -180~180)

### 문제 3: "생성된 마커 수: 0"
**원인**: 필터가 모든 프로젝트를 제외하거나 좌표가 유효하지 않음
**해결**: 
- 필터 설정 확인 (모든 체크박스가 체크되어 있는지)
- 콘솔의 경고 메시지 확인

### 문제 4: API 요청 실패
**원인**: 인증 토큰 만료 또는 서버 오류
**해결**: 
- 로그인 상태 확인
- Network 탭에서 오류 코드 확인
- 백엔드 서버 로그 확인

## 빠른 테스트

브라우저 콘솔에서 다음을 실행하여 데이터 확인:

```javascript
// 프로젝트 데이터 확인
console.log('전체 프로젝트:', allProjects);
console.log('필터링된 프로젝트:', filteredProjects);

// 좌표가 있는 프로젝트 확인
const withCoords = allProjects.filter(p => {
    const lat = parseFloat(p.lat || p.latitude);
    const lng = parseFloat(p.lng || p.longitude);
    return lat && lng && !isNaN(lat) && !isNaN(lng);
});
console.log('좌표가 있는 프로젝트:', withCoords);
```

## 다음 단계

1. 브라우저 콘솔의 메시지 확인
2. 데이터베이스에 좌표가 있는 프로젝트가 있는지 확인
3. 필요시 프로젝트에 좌표 정보 추가

문제가 계속되면 브라우저 콘솔의 전체 메시지를 확인하세요.

