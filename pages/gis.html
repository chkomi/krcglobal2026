<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ÌïúÍµ≠ÎÜçÏñ¥Ï¥åÍ≥µÏÇ¨ Í∏ÄÎ°úÎ≤åÏÇ¨ÏóÖÏ≤ò Ìï¥Ïô∏ÏÇ¨ÏóÖÍ¥ÄÎ¶¨ÏãúÏä§ÌÖú - GIS ÏßÄÎèÑ">
    <title>GIS ÏßÄÎèÑ | GBMS</title>

    <!-- KRDS Design System -->
    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/components.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="../frontend/lib/leaflet/leaflet.css" />

    <style>
        /* KRC Global Map Ïä§ÌÉÄÏùº - ÎÇ¥Î∂ÄÎßù ÏµúÏ†ÅÌôî */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "ÎßëÏùÄ Í≥†Îîï", "Apple SD Gothic Neo", sans-serif;
            overflow: hidden;
        }

        .gis-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* Ï¢åÏ∏° ÏÇ¨Ïù¥ÎìúÎ∞î */
        .gis-sidebar {
            width: 320px;
            background: var(--color-neutral-0);
            border-right: 1px solid var(--color-neutral-200);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Ìó§Îçî */
        .sidebar-header {
            padding: var(--spacing-5);
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .sidebar-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary-700);
            margin-bottom: var(--spacing-2);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .sidebar-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-neutral-600);
        }

        /* ÌïÑÌÑ∞ ÌÉ≠ */
        .filter-tabs {
            display: flex;
            gap: var(--spacing-2);
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .filter-tab {
            flex: 1;
            padding: var(--spacing-2) var(--spacing-3);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            background: var(--color-neutral-0);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-tab:hover {
            background: var(--color-neutral-50);
        }

        .filter-tab.active {
            background: var(--color-primary-500);
            color: var(--color-neutral-0);
            border-color: var(--color-primary-500);
        }

        .filter-tab.oda.active {
            background: #E65100;
            border-color: #E65100;
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-section {
            padding: var(--spacing-4);
            display: flex;
            gap: var(--spacing-3);
        }

        .stat-box {
            flex: 1;
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
            border: 2px solid;
        }

        .stat-box.consulting {
            border-color: var(--color-primary-500);
            background: var(--color-primary-50);
        }

        .stat-box.oda {
            border-color: #E65100;
            background: #FFF3E0;
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--color-neutral-600);
            margin-bottom: var(--spacing-1);
        }

        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
        }

        .stat-box.consulting .stat-value {
            color: var(--color-primary-700);
        }

        .stat-box.oda .stat-value {
            color: #E65100;
        }

        /* Íµ≠Í∞Ä Î¶¨Ïä§Ìä∏ */
        .country-list {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-4);
        }

        .continent-group {
            margin-bottom: var(--spacing-5);
        }

        .continent-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-700);
            margin-bottom: var(--spacing-3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .country-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            margin-bottom: var(--spacing-2);
        }

        .country-item:hover {
            background: var(--color-neutral-100);
        }

        .country-flag {
            font-size: 24px;
            width: 32px;
            text-align: center;
        }

        .country-name {
            flex: 1;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-neutral-900);
        }

        .project-badges {
            display: flex;
            gap: var(--spacing-1);
        }

        .project-badge {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
            color: var(--color-neutral-0);
        }

        .project-badge.consulting {
            background: var(--color-primary-500);
        }

        .project-badge.oda {
            background: #E65100;
        }

        /* ÏßÄÎèÑ ÏòÅÏó≠ */
        .gis-map {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Ïö∞Ï∏° ÏÉÅÎã® Î≤ÑÌäº */
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: var(--spacing-2);
        }

        .map-control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-neutral-0);
            border: none;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all var(--transition-fast);
        }

        .map-control-btn:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        /* ÌÉÄÏûÑÎùºÏù∏ Î™®Îã¨ */
        .timeline-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-6);
        }

        .timeline-modal.active {
            display: flex;
        }

        .timeline-content {
            background: var(--color-neutral-0);
            border-radius: var(--radius-xl);
            max-width: 900px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: var(--spacing-8);
            position: relative;
        }

        .timeline-close {
            position: absolute;
            top: var(--spacing-4);
            right: var(--spacing-4);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--color-neutral-100);
            border: none;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timeline-header {
            margin-bottom: var(--spacing-6);
        }

        .timeline-country {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-neutral-900);
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        /* ÌÉÄÏûÑÎùºÏù∏ */
        .timeline {
            position: relative;
            padding: var(--spacing-8) 0;
        }

        .timeline-axis {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: #4A2E2A;
            transform: translateY(-50%);
        }

        .timeline-items {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-8);
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
        }

        .timeline-item:nth-child(even) {
            flex-direction: row-reverse;
        }

        .timeline-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4A2E2A;
            border: 3px solid var(--color-neutral-0);
            flex-shrink: 0;
            z-index: 1;
        }

        .timeline-card {
            flex: 1;
            padding: var(--spacing-4);
            border-radius: var(--radius-lg);
            background: var(--color-neutral-0);
            border: 2px solid;
            box-shadow: var(--shadow-md);
        }

        .timeline-card.consulting {
            border-color: var(--color-primary-500);
        }

        .timeline-card.oda {
            border-color: #E65100;
        }

        .timeline-card-title {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-2);
        }

        .timeline-card-meta {
            display: flex;
            gap: var(--spacing-2);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-2);
        }

        .timeline-chip {
            padding: var(--spacing-1) var(--spacing-2);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }

        .timeline-chip.budget {
            background: var(--color-success-100);
            color: var(--color-success-500);
        }

        .timeline-chip.period {
            background: var(--color-neutral-100);
            color: var(--color-neutral-700);
        }

        .timeline-chip.status {
            background: var(--color-neutral-900);
            color: var(--color-neutral-0);
        }

        /* ÎßàÏª§ Ïä§ÌÉÄÏùº */
        .custom-marker {
            background: transparent !important;
            border: none !important;
        }

        .marker-flag {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .marker-flag.consulting {
            border-color: var(--color-primary-500);
        }

        .marker-flag.oda {
            border-color: #E65100;
        }

        .marker-flag.mixed {
            border-color: var(--color-neutral-700);
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .gis-sidebar {
                position: absolute;
                left: -320px;
                z-index: 1500;
                transition: left var(--transition-base);
            }

            .gis-sidebar.open {
                left: 0;
            }
        }
    </style>
</head>

<body>
    <div class="gis-container">
        <!-- Ï¢åÏ∏° ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <div class="gis-sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <span>üåè</span>
                    <span>GBMS Í∏ÄÎ°úÎ≤å ÏßÄÎèÑ</span>
                </div>
                <div class="sidebar-subtitle">Ìï¥Ïô∏ÏÇ¨ÏóÖ ÌòÑÌô©</div>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab consulting active" data-filter="consulting">Í∏∞Ïà†Ïª®ÏÑ§ÌåÖ</button>
                <button class="filter-tab oda active" data-filter="oda">ODA</button>
            </div>

            <div class="stats-section">
                <div class="stat-box consulting">
                    <div class="stat-label">Í∏∞Ïà†Ïª®ÏÑ§ÌåÖ</div>
                    <div class="stat-value" id="consultingCount">0</div>
                </div>
                <div class="stat-box oda">
                    <div class="stat-label">ODA</div>
                    <div class="stat-value" id="odaCount">0</div>
                </div>
            </div>

            <div class="country-list" id="countryList">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
            </div>
        </div>

        <!-- ÏßÄÎèÑ ÏòÅÏó≠ -->
        <div class="gis-map">
            <div id="map"></div>

            <div class="map-controls">
                <button class="map-control-btn" id="backBtn" title="ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞">‚Üê</button>
                <button class="map-control-btn" id="searchBtn" title="Í≤ÄÏÉâ">üîç</button>
                <button class="map-control-btn" id="menuBtn" title="Î©îÎâ¥">‚ò∞</button>
            </div>
        </div>
    </div>

    <!-- ÌÉÄÏûÑÎùºÏù∏ Î™®Îã¨ -->
    <div class="timeline-modal" id="timelineModal">
        <div class="timeline-content">
            <button class="timeline-close" id="closeTimeline">√ó</button>
            <div class="timeline-header">
                <div class="timeline-country" id="timelineCountry"></div>
            </div>
            <div class="timeline" id="timelineContainer">
                <div class="timeline-axis"></div>
                <div class="timeline-items" id="timelineItems">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/common.js"></script>
    <script src="../frontend/lib/leaflet/leaflet.js"></script>
    <script>
        // ÏÉòÌîå Îç∞Ïù¥ÌÑ∞
        const projects = [
            { country: 'Î≤†Ìä∏ÎÇ®', flag: 'üáªüá≥', lat: 16.0, lng: 108.0, category: 'Consulting', title: 'Ï∫ÑÎ≥¥ÎîîÏïÑ Í¥ÄÍ∞úÏãúÏÑ§ ÌòÑÎåÄÌôî', period: '2023-2025', budget: 8500, status: 'ÏßÑÌñâÏ§ë' },
            { country: 'Î≤†Ìä∏ÎÇ®', flag: 'üáªüá≥', lat: 16.0, lng: 108.0, category: 'ODA', title: 'Î≤†Ìä∏ÎÇ® Ïä§ÎßàÌä∏Ìåú Íµ¨Ï∂ï', period: '2024-2026', budget: 12000, status: 'ÏßÑÌñâÏ§ë' },
            { country: 'ÎùºÏò§Ïä§', flag: 'üá±üá¶', lat: 19.8563, lng: 102.4955, category: 'ODA', title: 'ÎùºÏò§Ïä§ ÎÜçÏóÖÏö©Ïàò Í∞úÎ∞ú', period: '2022-2024', budget: 5200, status: 'ÏôÑÎ£å' },
            { country: 'ÌïÑÎ¶¨ÌïÄ', flag: 'üáµüá≠', lat: 12.8797, lng: 121.7740, category: 'ODA', title: 'ÌïÑÎ¶¨ÌïÄ K-ÎùºÏù¥Ïä§Î≤®Ìä∏', period: '2024-2027', budget: 15000, status: 'Í∏∞Ìöç' },
            { country: 'Ïö∞Ï¶àÎ≤†ÌÇ§Ïä§ÌÉÑ', flag: 'üá∫üáø', lat: 41.3775, lng: 64.5853, category: 'Consulting', title: 'Ïö∞Ï¶àÎ≤†ÌÇ§Ïä§ÌÉÑ Í¥ÄÍ∞ú Ïª®ÏÑ§ÌåÖ', period: '2023-2024', budget: 6800, status: 'ÏôÑÎ£å' },
            { country: 'Ï∫ÑÎ≥¥ÎîîÏïÑ', flag: 'üá∞üá≠', lat: 12.5657, lng: 104.9910, category: 'Consulting', title: 'Ï∫ÑÎ≥¥ÎîîÏïÑ ÏàòÏûêÏõê Í¥ÄÎ¶¨', period: '2024-2025', budget: 7200, status: 'ÏßÑÌñâÏ§ë' },
            { country: 'ÎØ∏ÏñÄÎßà', flag: 'üá≤üá≤', lat: 21.9162, lng: 95.9560, category: 'Consulting', title: 'ÎØ∏ÏñÄÎßà ÎÜçÏóÖ Í∏∞Ïà†ÏßÄÏõê', period: '2023-2024', budget: 4500, status: 'ÏßÑÌñâÏ§ë' },
        ];

        let map, markersLayer;
        let activeFilters = { consulting: true, oda: true };

        // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
        function initMap() {
            map = L.map('map', {
                center: [20, 100],
                zoom: 4,
                zoomControl: true,
                maxBounds: [[-90, -180], [90, 180]],
                maxBoundsViscosity: 1.0
            });

            // Íµ¨Í∏Ä ÏßÄÎèÑ ÌÉÄÏùº (ÎÇ¥Î∂ÄÎßùÏóêÏÑúÎèÑ ÏÇ¨Ïö© Í∞ÄÎä•)
            L.tileLayer('https://mt{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
                attribution: '¬© Google Maps',
                maxZoom: 20,
                subdomains: ['0', '1', '2', '3'],
                tileSize: 256,
                zoomOffset: 0
            }).addTo(map);

            markersLayer = L.layerGroup().addTo(map);

            updateMap();
            updateCountryList();
            updateStats();
        }

        // ÏßÄÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMap() {
            markersLayer.clearLayers();

            const countryGroups = {};
            projects.forEach(p => {
                if (!activeFilters[p.category.toLowerCase()]) return;

                if (!countryGroups[p.country]) {
                    countryGroups[p.country] = { ...p, consulting: 0, oda: 0 };
                }
                countryGroups[p.country][p.category.toLowerCase() === 'consulting' ? 'consulting' : 'oda']++;
            });

            Object.values(countryGroups).forEach(country => {
                const hasConsulting = country.consulting > 0;
                const hasODA = country.oda > 0;
                const markerClass = hasConsulting && hasODA ? 'mixed' : hasConsulting ? 'consulting' : 'oda';

                const icon = L.divIcon({
                    html: `<div class="marker-flag ${markerClass}">${country.flag}</div>`,
                    className: 'custom-marker',
                    iconSize: [40, 40],
                    iconAnchor: [20, 20]
                });

                const marker = L.marker([country.lat, country.lng], { icon });
                marker.on('click', () => showTimeline(country.country));
                markersLayer.addLayer(marker);
            });
        }

        // Íµ≠Í∞Ä Î¶¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCountryList() {
            const continents = {
                'ÏïÑÏãúÏïÑ': ['Î≤†Ìä∏ÎÇ®', 'ÎùºÏò§Ïä§', 'ÌïÑÎ¶¨ÌïÄ', 'Ïö∞Ï¶àÎ≤†ÌÇ§Ïä§ÌÉÑ', 'Ï∫ÑÎ≥¥ÎîîÏïÑ', 'ÎØ∏ÏñÄÎßà']
            };

            const countryData = {};
            projects.forEach(p => {
                if (!countryData[p.country]) {
                    countryData[p.country] = { flag: p.flag, consulting: 0, oda: 0 };
                }
                countryData[p.country][p.category.toLowerCase() === 'consulting' ? 'consulting' : 'oda']++;
            });

            let html = '';
            Object.entries(continents).forEach(([continent, countries]) => {
                html += `<div class="continent-group">
                    <div class="continent-title">${continent}</div>`;

                countries.forEach(country => {
                    const data = countryData[country];
                    if (!data) return;

                    const showConsulting = activeFilters.consulting && data.consulting > 0;
                    const showODA = activeFilters.oda && data.oda > 0;

                    if (!showConsulting && !showODA) return;

                    html += `<div class="country-item" onclick="showTimeline('${country}')">
                        <div class="country-flag">${data.flag}</div>
                        <div class="country-name">${country}</div>
                        <div class="project-badges">
                            ${showConsulting ? `<div class="project-badge consulting">${data.consulting}</div>` : ''}
                            ${showODA ? `<div class="project-badge oda">${data.oda}</div>` : ''}
                        </div>
                    </div>`;
                });

                html += '</div>';
            });

            document.getElementById('countryList').innerHTML = html;
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats() {
            const stats = { consulting: 0, oda: 0 };
            projects.forEach(p => {
                stats[p.category.toLowerCase() === 'consulting' ? 'consulting' : 'oda']++;
            });

            document.getElementById('consultingCount').textContent = stats.consulting;
            document.getElementById('odaCount').textContent = stats.oda;
        }

        // ÌÉÄÏûÑÎùºÏù∏ ÌëúÏãú
        function showTimeline(country) {
            const countryProjects = projects.filter(p => p.country === country);
            const countryFlag = countryProjects[0]?.flag || '';

            document.getElementById('timelineCountry').innerHTML = `${countryFlag} ${country}`;

            let html = '';
            countryProjects.forEach((p, i) => {
                html += `<div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-card ${p.category.toLowerCase()}">
                        <div class="timeline-card-title">${p.title}</div>
                        <div class="timeline-card-meta">
                            <span class="timeline-chip period">${p.period}</span>
                            <span class="timeline-chip budget">${formatCurrency(p.budget * 1000000)}</span>
                            <span class="timeline-chip status">${p.status}</span>
                        </div>
                    </div>
                </div>`;
            });

            document.getElementById('timelineItems').innerHTML = html;
            document.getElementById('timelineModal').classList.add('active');
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.addEventListener('DOMContentLoaded', () => {
            initMap();

            // ÌïÑÌÑ∞ ÌÉ≠
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const filter = tab.dataset.filter;
                    activeFilters[filter] = !activeFilters[filter];
                    tab.classList.toggle('active');
                    updateMap();
                    updateCountryList();
                });
            });

            // ÌÉÄÏûÑÎùºÏù∏ Îã´Í∏∞
            document.getElementById('closeTimeline').addEventListener('click', () => {
                document.getElementById('timelineModal').classList.remove('active');
            });

            document.getElementById('timelineModal').addEventListener('click', (e) => {
                if (e.target.id === 'timelineModal') {
                    document.getElementById('timelineModal').classList.remove('active');
                }
            });

            // Î©îÎâ¥ Î≤ÑÌäº (Î™®Î∞îÏùº)
            document.getElementById('menuBtn').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('open');
            });
        });
    </script>
</body>

</html>